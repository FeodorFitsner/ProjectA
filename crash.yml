version: 1.21.{build}
build_script:
- ps: sleep 5
- ps: if (test-path $env:SystemRoot\Minidump\*.dmp) {appveyor PushArtifact -Path $env:SystemRoot\Minidump\*.dmp; throw "BSOD happened"}
- ps: if (test-path $env:SystemRoot\Memory.dmp) {appveyor PushArtifact -Path $env:SystemRoot\Memory.dmp; throw "BSOD happened"}
- ps: Set-ItemProperty -Path HKLM:\System\CurrentControlSet\Control\CrashControl -Name CrashDumpEnabled -Value 2
- ps: (New-Object Net.WebClient).DownloadFile("https://download.sysinternals.com/files/NotMyFault.zip", "$env:APPVEYOR_BUILD_FOLDER\NotMyFault.zip")
- ps: 7z e NotMyFault.zip
- ps: Write-host "before crash"
- ps: sleep 5
- ps: .\notmyfault64.exe /crash /accepteula
- ps: Write-host "after crash"
test: off
deploy: off
on_finish:
  - ps: $blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))
